---
import LayoutDefault from '~/layouts/LayoutDefault.astro'
import type { Post } from '~/types'
import { getPosts } from '~/utils'
const posts = await getPosts(true)

const yearMap = getYearMap(posts)

function getYearMap(posts: Post[]) {
  const result = new Map<number, Post[]>()
  for (const post of posts) {
    const year = (post.data.pubDate ?? new Date()).getFullYear()
    const posts = result.get(year) ?? []
    posts.push(post)
    result.set(year, posts)
  }
  return Array.from(result.entries())
}
---

<LayoutDefault>
  <section contain-layout flex="~ col gap-7.5">
    {
      yearMap.map(([year, posts]) => (
        <section flex="~ col gap-7.5">
          <h2 class="post-title font-header">{year}</h2>
          <ul class="pl-6" flex="~ col gap-4">
            {posts.map((post) => (
              <li>
                <h3 class="post-title font-header">
                  <a href={`/posts/${post.id}/`}>{post.data.title}</a>
                </h3>
              </li>
            ))}
          </ul>
        </section>
      ))
    }
  </section>
</LayoutDefault>
